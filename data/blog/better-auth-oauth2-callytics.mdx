---
title: 'Better Auth OAuth 2.0 with Callytics: A Better DX for OAuth Integration'
date: '2025-11-02'
tags: ['Better Auth', 'OAuth 2.0', 'Callytics', 'Cal.com', 'Next.js']
draft: false
summary: 'How Better Auth simplifies OAuth 2.0 integration in Next.js, eliminating the pain of manual callback and refresh token logicâ€”featuring my Cal.com OAuth integration in Callytics.'
---

In my previous work experience, integrating OAuth 2.0 for Meta (including Facebook and Instagram) and Outlook was a headacheâ€”requiring manual implementation of callbacks and refresh token logic.

Now, in the same Next.js environment, integrating Cal.com OAuth 2.0 in my Callytics project was effortless with Better Auth.

## ðŸš¨ The Old Way: Manual OAuth Pain

Previously, when integrating OAuth providers like Meta (Facebook/Instagram) and Outlook, I had to:

- Manually handle OAuth callbacks
- Write custom logic for access token acquisition
- Implement refresh token mechanisms from scratch
- Deal with token expiration edge cases

This approach was:

- Time-consuming
- Error-prone
- Difficult to maintain
- Required deep understanding of OAuth 2.0 specs

## âœ… The Better Auth Way: Generic OAuth Plugin

When integrating Cal.com OAuth 2.0 in my [Callytics](https://callytics.vercel.app) project using Better Auth's Generic OAuth plugin, the experience was dramatically different.

### What is the Generic OAuth Plugin?

Better Auth's Generic OAuth plugin allows you to integrate any OAuth 2.0 provider that follows the standard OAuth flow. Instead of manually implementing the OAuth flow, you simply configure the provider's endpoints and credentials.

For providers that support OpenID Connect discovery, you can use the `discoveryUrl` option, which automatically fetches all necessary endpoints from the provider's `.well-known/openid-configuration` endpoint.

### Key Features

**1. Auto-Generated Database Schema**

Better Auth automatically generates the necessary database schema for OAuth integration. No need to manually design tables for:

- User accounts and profiles
- OAuth accounts and providers
- Sessions and tokens
- Account linking

**2. Automatic Callback Handling**

The OAuth callback endpoint (`/api/auth/callback/:providerId`) is handled automatically by Better Authâ€”no custom route handlers needed. The plugin:

- Exchanges the authorization code for access tokens
- Retrieves user information from the provider
- Creates or links the user account
- Establishes a session

**3. Automatic Token Refresh**

Better Auth includes a sophisticated auto-refresh mechanism. When the `expires_in` field is present in the token response (RFC 6749 compliant), the library intelligently:

- Monitors token expiration
- Automatically refreshes access tokens before they expire
- Handles refresh token rotation
- Manages error scenarios gracefully
- Stores updated tokens securely

This means **no more manual token refresh logic**â€”it just works!

## ðŸ”§ Fixing the Cal.com OAuth Token Expiration Issue

While integrating Cal.com OAuth in Callytics, I discovered that users had to re-authenticate every 30 minutes. This was frustrating for the user experience.

After investigating, I found that Cal.com's OAuth token endpoint wasn't fully RFC 6749 compliant. It wasn't returning:

- `token_type` (should be "bearer")
- `expires_in` (token expiration time in seconds)

Without `expires_in`, Better Auth (and other OAuth clients) couldn't determine when to refresh the token, leading to frequent re-authentication.

### The Fix: PR #24841

I submitted [PR #24841](https://github.com/calcom/cal.com/pull/24841) to fix this issue:

**What changed:**

- Added `token_type: "bearer"` to the token response
- Added `expires_in: 1800` (30 minutes in seconds)
- Added proper cache headers (`Cache-Control: no-store`)

**Result:**

- Better Auth can now properly detect token expiration
- Automatic token refresh works seamlessly
- No more re-authentication every 30 minutes!
- Full RFC 6749 compliance

## ðŸ’¡ Key Benefits of Better Auth's Generic OAuth Plugin

**Good DX (Developer Experience)!**

1. **Universal OAuth Support** - Works with any OAuth 2.0 provider
2. **OpenID Connect Discovery** - Automatically fetches provider configuration
3. **Auto-generated schemas** - No manual database design
4. **Built-in callback handling** - No custom route logic
5. **Automatic token refresh** - No manual refresh logic when `expires_in` is provided
6. **Type safety** - Full TypeScript support
7. **Framework agnostic** - Works with Next.js, SvelteKit, and more

### Using the Generic OAuth Plugin

Once configured, triggering the OAuth flow is straightforward:

```typescript
import { createAuthClient } from "better-auth/client"

const authClient = createAuthClient()

// Trigger Cal.com OAuth login
await authClient.signIn.oauth({
  providerId: "calcom",
  callbackURL: "/dashboard", // Redirect after successful login
})
```

The plugin handles the entire OAuth flow:
1. Redirects to Cal.com's authorization page
2. User authorizes the application
3. Cal.com redirects back with an authorization code
4. Better Auth exchanges the code for tokens
5. User is authenticated and redirected to the callback URL

## ðŸ“Š Before vs After

### Before (Manual OAuth):

```typescript
// Manual callback handler
export async function GET(request: Request) {
  const code = new URL(request.url).searchParams.get('code')
  // Exchange code for token
  // Store tokens in database
  // Set up refresh logic
  // Handle errors
  // ... 50+ lines of code
}

// Manual refresh token logic
async function refreshAccessToken(refreshToken: string) {
  // Make refresh request
  // Update database
  // Handle expiration
  // ... 30+ lines of code
}
```

### After (Better Auth with Generic OAuth Plugin):

```typescript
import { betterAuth } from "better-auth"
import { genericOAuth } from "better-auth/plugins"

export const auth = betterAuth({
  // ... other config
  plugins: [
    genericOAuth({
      config: [
        {
          providerId: "calcom",
          discoveryUrl: "https://app.cal.com/.well-known/openid-configuration",
          clientId: process.env.CALCOM_CLIENT_ID,
          clientSecret: process.env.CALCOM_CLIENT_SECRET,
          scopes: ["openid", "profile", "email"],
        },
      ],
    }),
  ],
})

// That's it! Callback and refresh handled automatically
```

## ðŸš€ Conclusion

Better Auth transforms OAuth 2.0 integration from a tedious, error-prone task into a simple configuration step. By handling callbacks, token management, and refresh logic automatically, it lets developers focus on building features instead of wrestling with OAuth specifications.

If you're building a Next.js application that needs OAuth integration, I highly recommend trying Better Auth. The DX is truly better.

---

**Related Links:**

- [Better Auth Documentation](https://www.better-auth.com/)
- [Better Auth Generic OAuth Plugin](https://www.better-auth.com/docs/plugins/generic-oauth)
- [My Cal.com PR #24841](https://github.com/calcom/cal.com/pull/24841) - Fix OAuth token expiration
- [Better Auth Auto Refresh Source](https://github.com/better-auth/better-auth/blob/main/packages/core/src/oauth2/refresh-access-token.ts#L108-L123)

---

If you have experience with OAuth integration or thoughts on Better Auth, I'd love to hear from you!

> Like my posts? Try Cal.com â€” powerful, open-source scheduling. [Check it out](https://cal.link/refer-cal-com)
